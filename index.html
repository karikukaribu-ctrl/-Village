<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Avillage — du @ au réel</title>

  <style>
    :root{
      --bg:#0b0d10;
      --panel:#0f1319;
      --panel2:#0c1016;
      --fg:#e9eef7;
      --muted:#a6b0c2;
      --muted2:#7f8aa1;
      --line:#1c2430;

      --accent:#0f3f2f;   /* vert sapin très sombre */
      --accent2:#381b2e;  /* prune sombre */
      --accent3:#6b4a1f;  /* ocre sourd */
      --glow: 0 0 22px rgba(28, 175, 120, .18);

      --r:16px;
      --pad:16px;
      --max:1100px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(15,63,47,.25), transparent 55%),
                  radial-gradient(900px 500px at 85% 35%, rgba(56,27,46,.22), transparent 50%),
                  radial-gradient(900px 600px at 45% 90%, rgba(107,74,31,.14), transparent 55%),
                  var(--bg);
      color:var(--fg);
      font-family:var(--sans);
      letter-spacing:.2px;
    }

    a{ color:inherit; text-decoration:none; }
    button, input, textarea, select{ font:inherit; color:inherit; }
    .wrap{ max-width:var(--max); margin:0 auto; padding:28px 16px 48px; }

    /* Top bar */
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      position:sticky; top:0; z-index:50;
      background: linear-gradient(to bottom, rgba(11,13,16,.92), rgba(11,13,16,.55));
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
      padding:12px 16px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 220px;
    }
    .mark{
      width:34px; height:34px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, rgba(28,175,120,.35), rgba(15,63,47,.15));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--glow);
      display:grid; place-items:center;
      font-family:var(--mono);
      font-weight:700;
    }
    .brand h1{
      margin:0;
      font-size:14px;
      font-weight:650;
      letter-spacing:.6px;
    }
    .brand small{
      display:block;
      margin-top:2px;
      color:var(--muted2);
      font-size:12px;
      letter-spacing:.2px;
    }
    .actions{ display:flex; align-items:center; gap:10px; }
    .chip{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      padding:9px 12px;
      border-radius:999px;
      color:var(--muted);
      font-size:13px;
      display:flex; gap:8px; align-items:center;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .chip:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.16); }
    .chip strong{ color:var(--fg); font-weight:650; }

    /* Layout */
    .hero{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .hero{ grid-template-columns: 1fr; }
      .brand{ min-width:auto; }
    }

    .card{
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.015));
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .card .hd{
      padding: 18px 18px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.08);
    }
    .card .hd h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .card .hd p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .card .bd{ padding: 16px 18px; }

    /* Minimal “prompt box” */
    .prompt{
      display:flex; gap:10px; align-items:center;
      padding:10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    .prompt input{
      width:100%;
      border:0;
      outline:none;
      background: transparent;
      color:var(--fg);
      font-size:14px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:13px;
      font-weight:650;
      letter-spacing:.2px;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.16); }
    .btn.primary{
      border-color: rgba(28,175,120,.22);
      background: linear-gradient(180deg, rgba(15,63,47,.55), rgba(15,63,47,.25));
      box-shadow: var(--glow);
    }
    .btn.ghost{
      background: transparent;
      border-color: rgba(255,255,255,.12);
    }

    /* Spiral nav */
    .spiralWrap{
      position:relative;
      height: 420px;
      display:grid;
      place-items:center;
      overflow:hidden;
      background:
        radial-gradient(800px 500px at 50% 50%, rgba(255,255,255,.035), transparent 65%),
        rgba(0,0,0,.10);
    }
    @media (max-width:920px){
      .spiralWrap{ height: 380px; }
    }
    .spiralBg{
      position:absolute; inset:-60px;
      opacity:.95;
      filter: drop-shadow(0 0 20px rgba(28,175,120,.12));
      pointer-events:none;
    }
    .spiralBg path{
      stroke: rgba(255,255,255,.16);
      stroke-width: 2.2;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .spiralCore{
      position:absolute;
      width: 240px; height:240px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.05), rgba(0,0,0,.15));
      display:grid; place-items:center;
      text-align:center;
      padding: 16px;
    }
    .spiralCore .tag{
      font-family: var(--mono);
      color: rgba(255,255,255,.75);
      font-size: 12px;
      letter-spacing: .6px;
      text-transform: uppercase;
      opacity:.9;
    }
    .spiralCore .big{
      margin-top:10px;
      font-size: 15px;
      font-weight: 750;
      letter-spacing: .2px;
    }
    .spiralCore .sub{
      margin-top:8px;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }

    .node{
      position:absolute;
      display:flex; flex-direction:column; gap:6px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      min-width: 160px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      backdrop-filter: blur(8px);
    }
    .node:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.18);
    }
    .node .k{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: rgba(255,255,255,.65);
    }
    .node .t{
      font-size: 13px;
      font-weight: 720;
      letter-spacing: .2px;
    }
    .node .d{
      font-size: 12px;
      color: var(--muted);
      line-height:1.25;
    }

    /* Node positions around an @-like swirl */
    .n-enterprise{ top: 55px; left: 55px; }
    .n-family{ top: 55px; right: 55px; }
    .n-pro{ bottom: 70px; left: 70px; }
    .n-irl{ bottom: 70px; right: 70px; }
    .n-loop{ top: 180px; right: 35px; min-width: 150px; }
    .n-res{ top: 180px; left: 35px; min-width: 150px; }

    @media (max-width: 520px){
      .node{ min-width: 145px; padding:9px 10px; }
      .n-enterprise{ top: 40px; left: 16px; }
      .n-family{ top: 40px; right: 16px; }
      .n-pro{ bottom: 60px; left: 18px; }
      .n-irl{ bottom: 60px; right: 18px; }
      .n-loop{ top: 170px; right: 8px; }
      .n-res{ top: 170px; left: 8px; }
      .spiralCore{ width: 220px; height:220px; }
    }

    /* Sections */
    .grid2{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
    }
    @media (max-width: 920px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .pillRow{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      font-size:12px;
      color: var(--muted);
    }
    .pill b{ color: var(--fg); font-weight:650; }

    /* Form */
    .form{
      display:grid;
      gap:10px;
    }
    label{
      font-size:12px;
      color: var(--muted);
      display:block;
      margin-bottom:6px;
    }
    .field{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding:10px 12px;
      outline:none;
      width:100%;
    }
    textarea.field{ min-height: 96px; resize: vertical; }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }
    .hint{
      margin-top:8px;
      color: var(--muted2);
      font-size:12px;
      line-height:1.35;
    }

    /* Console (activity) */
    .log{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.78);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      border-radius: 14px;
      padding: 10px 12px;
      max-height: 190px;
      overflow:auto;
      white-space: pre-wrap;
    }

    /* Modal */
    .modalOverlay{
      position:fixed; inset:0; z-index:80;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(8px);
      display:none;
      align-items:center; justify-content:center;
      padding:16px;
    }
    .modal{
      width:min(820px, 100%);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(15,19,25,.98), rgba(12,16,22,.92));
      box-shadow: 0 18px 70px rgba(0,0,0,.5);
      overflow:hidden;
    }
    .modalHd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .modalHd .title{
      font-weight: 750;
      letter-spacing:.2px;
      font-size: 14px;
    }
    .modalBd{ padding:16px; }
    .modal.showing{ animation: pop .14s ease-out; }
    @keyframes pop{
      from{ transform: translateY(6px) scale(.99); opacity: .8; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    /* Footer */
    footer{
      margin-top:18px;
      color: var(--muted2);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      opacity:.9;
    }
    .sep{ opacity:.35; padding:0 6px; }
  </style>
</head>

<body>
  <div class="top">
    <div class="brand">
      <div class="mark">@</div>
      <div>
        <h1>Avillage</h1>
        <small>Du @ au réel — connecter pour se rencontrer</small>
      </div>
    </div>
    <div class="actions">
      <div class="chip" id="modeChip" title="Changer de porte d'entrée">
        <span style="opacity:.8">Mode</span>
        <strong id="modeLabel">Accueil</strong>
      </div>
      <button class="chip" id="openBrief" title="Voir le principe de la boucle">La boucle</button>
      <button class="chip" id="openSettings" title="Préférences locales">Préférences</button>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <!-- LEFT: Minimal “chat-like” entry -->
      <div class="card">
        <div class="hd">
          <h2>Une interface sobre. Un objectif clair.</h2>
          <p>
            Avillage n’optimise pas le temps d’écran : il optimise le retour au réel.
            Choisis une porte d’entrée, et la plateforme fait le lien.
          </p>
          <div class="pillRow">
            <span class="pill"><b>Prévention</b> (pas de soin)</span>
            <span class="pill"><b>Orientation</b> fonctionnelle</span>
            <span class="pill"><b>Réseau</b> validé</span>
            <span class="pill"><b>IRL</b> en sortie</span>
          </div>
        </div>
        <div class="bd">
          <div class="prompt" aria-label="Boîte d'entrée">
            <input id="quickInput" placeholder="Ex: “Je suis parent et j’ai besoin d’une orientation simple après une conférence.”" />
            <button class="btn primary" id="quickGo">Ouvrir</button>
          </div>
          <div class="hint">
            Astuce : tape juste <span style="font-family:var(--mono);">entreprise</span>, <span style="font-family:var(--mono);">parent</span>, ou <span style="font-family:var(--mono);">intervenant</span>.
          </div>

          <div style="margin-top:14px;">
            <div class="hint" style="margin:0 0 8px;">Journal local (démo)</div>
            <div class="log" id="activityLog"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: @ spiral navigation -->
      <div class="card">
        <div class="hd">
          <h2>Navigation “@”</h2>
          <p>Le @ est une carte : entrer par le numérique, s’ouvrir vers l’extérieur.</p>
        </div>
        <div class="spiralWrap">
          <!-- background swirl -->
          <svg class="spiralBg" viewBox="0 0 600 600" aria-hidden="true">
            <!-- A stylized open spiral-ish path (not a perfect @, but evokes it) -->
            <path d="M335 90
                     C210 95, 120 190, 120 300
                     C120 425, 215 515, 340 515
                     C460 515, 540 430, 540 325
                     C540 220, 460 150, 360 150
                     C275 150, 215 210, 215 292
                     C215 365, 268 417, 340 417
                     C405 417, 450 372, 450 310
                     C450 255, 410 215, 352 215
                     C300 215, 268 250, 268 300
                     C268 345, 300 375, 342 375
                     C380 375, 405 348, 405 310" />
            <!-- open tail going outwards -->
            <path d="M405 310 C430 300, 470 300, 505 315 C548 334, 575 365, 585 402" />
          </svg>

          <div class="spiralCore">
            <div class="tag">Avillage</div>
            <div class="big">Choisis ton entrée</div>
            <div class="sub">Entreprise, Famille, Intervenant… puis sortie IRL.</div>
            <div style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
              <button class="btn ghost" id="goHome">Accueil</button>
              <button class="btn primary" id="goIrl">IRL</button>
            </div>
          </div>

          <div class="node n-enterprise" data-target="enterprise">
            <div class="k">Porte 1</div>
            <div class="t">Entreprise</div>
            <div class="d">Conférence → continuité → impact.</div>
          </div>

          <div class="node n-family" data-target="family">
            <div class="k">Porte 2</div>
            <div class="t">Famille</div>
            <div class="d">Orientation simple, sans errance.</div>
          </div>

          <div class="node n-pro" data-target="pro">
            <div class="k">Porte 3</div>
            <div class="t">Intervenant</div>
            <div class="d">Réseau, missions, qualité.</div>
          </div>

          <div class="node n-irl" data-target="irl">
            <div class="k">Sortie</div>
            <div class="t">Village IRL</div>
            <div class="d">Rencontres réelles, local.</div>
          </div>

          <div class="node n-loop" data-target="loop">
            <div class="k">Principe</div>
            <div class="t">La boucle</div>
            <div class="d">Du @ au réel.</div>
          </div>

          <div class="node n-res" data-target="resources">
            <div class="k">Accès</div>
            <div class="t">Ressources</div>
            <div class="d">Triées, ciblées.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom panels -->
    <div class="grid2">
      <div class="card" id="panelMain">
        <div class="hd">
          <h2 id="panelTitle">Accueil</h2>
          <p id="panelDesc">Choisis une porte d’entrée. On garde tout minimal, utile, et orienté réel.</p>
        </div>
        <div class="bd" id="panelBody">
          <div class="pillRow">
            <span class="pill"><b>1</b> Sensibilisation</span>
            <span class="pill"><b>2</b> Orientation</span>
            <span class="pill"><b>3</b> Mise en lien</span>
            <span class="pill"><b>4</b> Sortie IRL</span>
          </div>

          <div style="margin-top:14px; color:var(--muted); font-size:13px; line-height:1.5;">
            Avillage est une plateforme d’orientation et de mise en réseau.
            <b style="color:var(--fg); font-weight:650;">Pas de diagnostic, pas de soins.</b>
            L’écran sert à retrouver du réel.
          </div>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" data-open="enterprise">Je suis une entreprise</button>
            <button class="btn primary" data-open="family">Je suis parent / famille</button>
            <button class="btn primary" data-open="pro">Je suis intervenant</button>
            <button class="btn ghost" data-open="irl">Je veux du IRL près de chez moi</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>Mini “moteur d’orientation” (démo)</h2>
          <p>Un tri fonctionnel (pas médical) qui propose une prochaine étape simple.</p>
        </div>
        <div class="bd">
          <div class="form">
            <div class="row">
              <div>
                <label>Contexte</label>
                <select class="field" id="ctx">
                  <option value="after_talk">Après une conférence (entreprise)</option>
                  <option value="family">À la maison / en famille</option>
                  <option value="school">École / encadrement</option>
                  <option value="self">Moi-même (adulte)</option>
                </select>
              </div>
              <div>
                <label>Priorité</label>
                <select class="field" id="prio">
                  <option value="conflict">Conflits / tensions</option>
                  <option value="sleep">Sommeil / rythme</option>
                  <option value="time">Temps d’écran excessif</option>
                  <option value="mood">Humeur / irritabilité</option>
                  <option value="focus">Concentration / fatigue</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div>
                <label>Âge principal concerné</label>
                <select class="field" id="age">
                  <option value="child">Enfant</option>
                  <option value="teen">Adolescent</option>
                  <option value="adult">Adulte</option>
                </select>
              </div>
              <div>
                <label>Objectif immédiat</label>
                <select class="field" id="goal">
                  <option value="plan">Plan simple en 7 jours</option>
                  <option value="resources">Ressources ciblées</option>
                  <option value="connect">Être mis en relation</option>
                  <option value="irl">Trouver du IRL proche</option>
                </select>
              </div>
            </div>

            <button class="btn primary" id="triageGo">Proposer ma prochaine étape</button>
            <div class="hint" id="triageOut"></div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div>
        <span style="font-family:var(--mono);">@</span> Avillage — prototype MVP (local)
        <span class="sep">•</span>
        <span>Pas de collecte de données sensibles.</span>
      </div>
      <div>
        <a href="#" id="exportBtn" style="text-decoration:underline; text-underline-offset:3px;">Exporter</a>
        <span class="sep">•</span>
        <a href="#" id="resetBtn" style="text-decoration:underline; text-underline-offset:3px;">Réinitialiser</a>
      </div>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modalOverlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="modal">
      <div class="modalHd">
        <div class="title" id="modalTitle">—</div>
        <div style="display:flex; gap:8px;">
          <button class="btn ghost" id="closeModal">Fermer</button>
        </div>
      </div>
      <div class="modalBd" id="modalBody"></div>
    </div>
  </div>

<script>
  // ---------- Helpers ----------
  const $ = (q, el=document) => el.querySelector(q);
  const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));
  const now = () => new Date().toLocaleString('fr-BE');
  const store = {
    get(k, fallback=null){
      try{ return JSON.parse(localStorage.getItem(k)) ?? fallback; }catch(e){ return fallback; }
    },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
  };

  // ---------- State ----------
  const state = {
    mode: store.get("avillage_mode", "Accueil"),
    log: store.get("avillage_log", []),
    leads: store.get("avillage_leads", []),
    settings: store.get("avillage_settings", {
      accent: "sapin",
      privacy: "minimal",
      language: "fr"
    })
  };

  // ---------- Activity log ----------
  function addLog(msg){
    state.log.unshift(`[${now()}] ${msg}`);
    state.log = state.log.slice(0, 80);
    store.set("avillage_log", state.log);
    renderLog();
  }
  function renderLog(){
    const el = $("#activityLog");
    el.textContent = state.log.length ? state.log.join("\n") : "Aucune activité pour l’instant. (C’est un prototype local.)";
  }

  // ---------- Modal ----------
  const overlay = $("#overlay");
  const modal = $("#modal");
  const modalTitle = $("#modalTitle");
  const modalBody = $("#modalBody");

  function openModal(title, html){
    modalTitle.textContent = title;
    modalBody.innerHTML = html;
    overlay.style.display = "flex";
    overlay.setAttribute("aria-hidden","false");
    modal.classList.add("showing");
    setTimeout(()=> modal.classList.remove("showing"), 160);
  }
  function closeModal(){
    overlay.style.display = "none";
    overlay.setAttribute("aria-hidden","true");
    modalBody.innerHTML = "";
  }
  $("#closeModal").addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });
  document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

  // ---------- Panels ----------
  function setMode(label){
    state.mode = label;
    store.set("avillage_mode", label);
    $("#modeLabel").textContent = label;
  }

  function setMainPanel(kind){
    const panelTitle = $("#panelTitle");
    const panelDesc = $("#panelDesc");
    const panelBody = $("#panelBody");

    const defs = {
      home: {
        title: "Accueil",
        desc: "Choisis une porte d’entrée. On garde tout minimal, utile, et orienté réel.",
        body: `
          <div class="pillRow">
            <span class="pill"><b>1</b> Sensibilisation</span>
            <span class="pill"><b>2</b> Orientation</span>
            <span class="pill"><b>3</b> Mise en lien</span>
            <span class="pill"><b>4</b> Sortie IRL</span>
          </div>
          <div style="margin-top:14px; color:var(--muted); font-size:13px; line-height:1.5;">
            Avillage est une plateforme d’orientation et de mise en réseau.
            <b style="color:var(--fg); font-weight:650;">Pas de diagnostic, pas de soins.</b>
            L’écran sert à retrouver du réel.
          </div>
          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" data-open="enterprise">Je suis une entreprise</button>
            <button class="btn primary" data-open="family">Je suis parent / famille</button>
            <button class="btn primary" data-open="pro">Je suis intervenant</button>
            <button class="btn ghost" data-open="irl">Je veux du IRL près de chez moi</button>
          </div>
        `
      },
      enterprise: {
        title: "Entreprise",
        desc: "Conférence → continuité → orientation → IRL. Sans surcharge RH.",
        body: enterpriseForm()
      },
      family: {
        title: "Famille / Parent",
        desc: "Après une conférence (ou pas) : une prochaine étape claire, maintenant.",
        body: familyForm()
      },
      pro: {
        title: "Intervenant",
        desc: "Réseau validé, missions, qualité, continuité (sans promesses cliniques).",
        body: proForm()
      },
      resources: {
        title: "Ressources",
        desc: "Bibliothèque minimaliste (prototype). À enrichir et profiler.",
        body: resourcesView()
      },
      irl: {
        title: "Village IRL",
        desc: "Sortie vers le réel : groupes, AMO, activités, lieux, projets.",
        body: irlView()
      },
      loop: {
        title: "La boucle",
        desc: "Un flux : entreprise → sensibilisation → plateforme → mise en lien → IRL.",
        body: loopView()
      }
    };

    const d = defs[kind] || defs.home;
    panelTitle.textContent = d.title;
    panelDesc.textContent = d.desc;
    panelBody.innerHTML = d.body;

    // wire open buttons
    $$("[data-open]", panelBody).forEach(btn=>{
      btn.addEventListener("click", ()=> navigate(btn.getAttribute("data-open")));
    });
  }

  function navigate(kind){
    const map = {
      enterprise: "Entreprise",
      family: "Famille",
      pro: "Intervenant",
      irl: "Village IRL",
      loop: "La boucle",
      resources: "Ressources",
      home: "Accueil"
    };
    setMode(map[kind] || "Accueil");
    setMainPanel(kind);
    addLog(`Navigation → ${map[kind] || kind}`);
  }

  // ---------- Forms / Views ----------
  function enterpriseForm(){
    return `
      <div class="form">
        <div class="row">
          <div>
            <label>Organisation</label>
            <input class="field" id="ent_org" placeholder="Nom de l'entreprise / institution" />
          </div>
          <div>
            <label>Contact</label>
            <input class="field" id="ent_mail" placeholder="Email" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Format</label>
            <select class="field" id="ent_format">
              <option>Conférence (1h)</option>
              <option>Masterclass (2h)</option>
              <option>Cycle (3×1h)</option>
              <option>Programme (8 semaines)</option>
            </select>
          </div>
          <div>
            <label>Public</label>
            <select class="field" id="ent_audience">
              <option>Parents salariés</option>
              <option>Tout public</option>
              <option>Managers / RH</option>
            </select>
          </div>
        </div>

        <div>
          <label>Objectif (1 phrase)</label>
          <input class="field" id="ent_goal" placeholder="Ex: Continuité après sensibilisation + orientation concrète vers ressources/IRL" />
        </div>

        <div>
          <label>Contrainte principale</label>
          <select class="field" id="ent_constraint">
            <option>Peu de temps / pas de surcharge RH</option>
            <option>Budget limité</option>
            <option>Besoin de mesure / reporting</option>
            <option>Public sensible (mineurs indirectement)</option>
          </select>
        </div>

        <div class="row">
          <button class="btn primary" id="ent_submit">Demander une proposition</button>
          <button class="btn ghost" id="ent_sample">Voir un exemple de boucle</button>
        </div>

        <div class="hint">
          Avillage propose une continuité : après l’intervention, accès plateforme + orientation + mise en lien + sortie IRL.
          <br><span style="font-family:var(--mono);opacity:.9;">(prototype) Les données restent dans ton navigateur.</span>
        </div>
      </div>
    `;
  }

  function familyForm(){
    return `
      <div class="form">
        <div class="row">
          <div>
            <label>Situation</label>
            <select class="field" id="fam_sit">
              <option>Après une conférence (entreprise)</option>
              <option>Conflits autour des écrans</option>
              <option>Sommeil perturbé</option>
              <option>Temps d’écran excessif</option>
              <option>Besoin d’alternatives IRL</option>
            </select>
          </div>
          <div>
            <label>Âge concerné</label>
            <select class="field" id="fam_age">
              <option>Enfant</option>
              <option>Adolescent</option>
              <option>Adulte</option>
              <option>Famille entière</option>
            </select>
          </div>
        </div>

        <div>
          <label>Ce que tu veux maintenant (1 phrase)</label>
          <input class="field" id="fam_need" placeholder="Ex: un plan simple en 7 jours + une piste IRL près de chez moi" />
        </div>

        <div class="row">
          <button class="btn primary" id="fam_submit">Obtenir une prochaine étape</button>
          <button class="btn ghost" id="fam_irl">Aller vers Village IRL</button>
        </div>

        <div class="hint" id="fam_out"></div>
      </div>
    `;
  }

  function proForm(){
    return `
      <div class="form">
        <div class="row">
          <div>
            <label>Nom / structure</label>
            <input class="field" id="pro_name" placeholder="Nom + éventuelle structure" />
          </div>
          <div>
            <label>Email</label>
            <input class="field" id="pro_mail" placeholder="Email professionnel" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Profession</label>
            <select class="field" id="pro_role">
              <option>Médecin</option>
              <option>Psychologue</option>
              <option>Neuropsychologue</option>
              <option>Éducateur spécialisé</option>
              <option>Travailleur social</option>
              <option>Autre</option>
            </select>
          </div>
          <div>
            <label>Modalités</label>
            <select class="field" id="pro_mode">
              <option>Présentiel</option>
              <option>En ligne</option>
              <option>Hybride</option>
            </select>
          </div>
        </div>

        <div>
          <label>Ce que tu proposes (bref)</label>
          <textarea class="field" id="pro_offer" placeholder="Ex: ateliers parents, groupes, TCC, psychoéducation, conférences entreprise…"></textarea>
        </div>

        <div class="row">
          <button class="btn primary" id="pro_submit">Demander accès réseau</button>
          <button class="btn ghost" id="pro_charter">Voir la charte (brouillon)</button>
        </div>

        <div class="hint">
          Réseau = qualité + continuité. Avillage oriente, tu accompagnes.
          <br><span style="font-family:var(--mono);opacity:.9;">(prototype) Les données restent dans ton navigateur.</span>
        </div>
      </div>
    `;
  }

  function resourcesView(){
    // minimal “curated” stub; later you’ll load from a JSON
    const items = [
      {cat:"Fondations", t:"Du @ au réel : principes", d:"Pourquoi l’objectif n’est pas de supprimer l’écran, mais de reconstruire le lien."},
      {cat:"Famille", t:"Plan 7 jours (prototype)", d:"Micro-changements : rythme, zones sans écran, alternatives IRL."},
      {cat:"Entreprise", t:"Pack post-conférence", d:"Continuité : ressources ciblées + orientation + mise en lien."},
      {cat:"Intervenants", t:"Standards Avillage", d:"Qualité, non-promesses cliniques, feedback, déréférencement."},
    ];
    return `
      <div class="form">
        ${items.map(x=>`
          <div style="border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:rgba(255,255,255,.02);">
            <div style="font-family:var(--mono); font-size:11px; letter-spacing:.6px; text-transform:uppercase; color:rgba(255,255,255,.65);">${x.cat}</div>
            <div style="margin-top:6px; font-weight:750; font-size:13px;">${x.t}</div>
            <div style="margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.35;">${x.d}</div>
          </div>
        `).join("")}
        <div class="hint">Cette section sera alimentée par une base (JSON/Airtable). Ici : simple démo.</div>
      </div>
    `;
  }

  function irlView(){
    return `
      <div class="form">
        <div class="row">
          <div>
            <label>Zone</label>
            <input class="field" id="irl_zone" placeholder="Ex: Bruxelles / Ixelles / Schaerbeek…" />
          </div>
          <div>
            <label>Type</label>
            <select class="field" id="irl_type">
              <option>Groupes de parents</option>
              <option>AMO / jeunesse</option>
              <option>Activités sport / art</option>
              <option>Jeux de société / tiers-lieux</option>
              <option>Soutien psycho-social</option>
            </select>
          </div>
        </div>

        <div>
          <label>Ce que tu cherches</label>
          <input class="field" id="irl_need" placeholder="Ex: alternative aux écrans, lien social, activité hebdomadaire..." />
        </div>

        <div class="row">
          <button class="btn primary" id="irl_submit">Proposer des pistes IRL</button>
          <button class="btn ghost" id="irl_stub">Pourquoi IRL ?</button>
        </div>

        <div class="hint" id="irl_out"></div>
      </div>
    `;
  }

  function loopView(){
    return `
      <div style="display:grid; gap:10px;">
        <div style="border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:rgba(255,255,255,.02);">
          <div style="font-family:var(--mono); font-size:11px; letter-spacing:.6px; text-transform:uppercase; color:rgba(255,255,255,.65);">Étape 1</div>
          <div style="margin-top:6px; font-weight:800;">Entreprise</div>
          <div style="margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.35;">Activation par conférence / cycle (temps de travail, sans charge mentale).</div>
        </div>

        <div style="border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:rgba(255,255,255,.02);">
          <div style="font-family:var(--mono); font-size:11px; letter-spacing:.6px; text-transform:uppercase; color:rgba(255,255,255,.65);">Étape 2</div>
          <div style="margin-top:6px; font-weight:800;">Plateforme</div>
          <div style="margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.35;">Orientation fonctionnelle + ressources ciblées + prochaine étape claire.</div>
        </div>

        <div style="border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:rgba(255,255,255,.02);">
          <div style="font-family:var(--mono); font-size:11px; letter-spacing:.6px; text-transform:uppercase; color:rgba(255,255,255,.65);">Étape 3</div>
          <div style="margin-top:6px; font-weight:800;">Mise en lien</div>
          <div style="margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.35;">Parents ↔ intervenants, demandes mieux orientées, feedback qualité.</div>
        </div>

        <div style="border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:rgba(255,255,255,.02);">
          <div style="font-family:var(--mono); font-size:11px; letter-spacing:.6px; text-transform:uppercase; color:rgba(255,255,255,.65);">Étape 4</div>
          <div style="margin-top:6px; font-weight:800;">Village IRL</div>
          <div style="margin-top:6px; color:var(--muted); font-size:12.5px; line-height:1.35;">Sortie vers le réel : groupes, activités, structures locales.</div>
        </div>

        <div class="hint">Le succès se mesure à un truc simple : moins d’errance, plus de réel.</div>
      </div>
    `;
  }

  // ---------- Wire up dynamic events after panel render ----------
  function wirePanelEvents(){
    // enterprise
    const entSubmit = $("#ent_submit");
    if(entSubmit){
      entSubmit.addEventListener("click", ()=>{
        const lead = {
          type:"enterprise",
          org: $("#ent_org").value.trim(),
          mail: $("#ent_mail").value.trim(),
          format: $("#ent_format").value,
          audience: $("#ent_audience").value,
          goal: $("#ent_goal").value.trim(),
          constraint: $("#ent_constraint").value,
          ts: Date.now()
        };
        state.leads.unshift(lead);
        state.leads = state.leads.slice(0, 200);
        store.set("avillage_leads", state.leads);
        addLog(`Lead entreprise enregistré: ${lead.org || "(sans nom)"} — ${lead.format}`);
        openModal("Demande enregistrée (prototype)", `
          <div style="color:var(--muted); font-size:13px; line-height:1.5;">
            Merci. Ceci est un prototype local.
            <br><br><b style="color:var(--fg);">Prochaine étape :</b> envoyer un email “proposition” (template) + plan de boucle post-conférence.
          </div>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" id="copyEntTemplate">Copier un email de réponse</button>
            <button class="btn ghost" id="closeNow">Fermer</button>
          </div>
        `);
        setTimeout(()=>{
          const c = $("#copyEntTemplate");
          if(c) c.addEventListener("click", ()=>{
            const txt =
`Objet: Avillage — proposition “conférence + continuité”
Bonjour,

Merci pour votre intérêt. Avillage propose une approche simple: une intervention de sensibilisation sur le temps de travail, suivie d’une continuité immédiate via la plateforme (orientation fonctionnelle, ressources ciblées, mise en lien avec intervenants, et sortie IRL).

Format souhaité: ${lead.format}
Public: ${lead.audience}
Objectif: ${lead.goal || "(à préciser)"}

Prochaine étape: 15 minutes pour cadrer le besoin et vous envoyer une proposition (contenu + déroulé + modalité de suivi).

Bien à vous,
[Nom / Avillage]`;
            navigator.clipboard?.writeText(txt);
            addLog("Template email entreprise copié (clipboard).");
          });
          const closeNow = $("#closeNow");
          if(closeNow) closeNow.addEventListener("click", closeModal);
        }, 0);
      });
    }

    const entSample = $("#ent_sample");
    if(entSample){
      entSample.addEventListener("click", ()=>{
        openModal("Exemple de boucle (synthèse)", loopView());
      });
    }

    // family
    const famSubmit = $("#fam_submit");
    if(famSubmit){
      famSubmit.addEventListener("click", ()=>{
        const sit = $("#fam_sit").value;
        const age = $("#fam_age").value;
        const need = $("#fam_need").value.trim();

        const suggestion = suggestNextStep({sit, age, need, goal:"plan"});
        const out = $("#fam_out");
        out.innerHTML = `<b style="color:var(--fg); font-weight:750;">Prochaine étape :</b> ${suggestion.html}`;
        addLog(`Orientation famille: ${sit} / ${age}`);
      });
    }
    const famIrl = $("#fam_irl");
    if(famIrl){
      famIrl.addEventListener("click", ()=> navigate("irl"));
    }

    // pro
    const proSubmit = $("#pro_submit");
    if(proSubmit){
      proSubmit.addEventListener("click", ()=>{
        const lead = {
          type:"pro",
          name: $("#pro_name").value.trim(),
          mail: $("#pro_mail").value.trim(),
          role: $("#pro_role").value,
          mode: $("#pro_mode").value,
          offer: $("#pro_offer").value.trim(),
          ts: Date.now()
        };
        state.leads.unshift(lead);
        state.leads = state.leads.slice(0, 200);
        store.set("avillage_leads", state.leads);
        addLog(`Lead intervenant enregistré: ${lead.name || "(sans nom)"} — ${lead.role}`);
        openModal("Demande enregistrée (prototype)", `
          <div style="color:var(--muted); font-size:13px; line-height:1.5;">
            Merci. Étape suivante : validation + charte + test qualité (feedback).
            <br><br><b style="color:var(--fg);">Rappel :</b> Avillage n’est pas une plateforme de soin, mais de continuité & orientation.
          </div>
          <div style="margin-top:12px; display:flex; gap:10px;">
            <button class="btn primary" id="copyProTemplate">Copier un message de réponse</button>
            <button class="btn ghost" id="closeNow2">Fermer</button>
          </div>
        `);
        setTimeout(()=>{
          const c = $("#copyProTemplate");
          if(c) c.addEventListener("click", ()=>{
            const txt =
`Bonjour,

Merci pour votre demande. Avillage est un réseau structuré qui vise la continuité entre sensibilisation, orientation et mise en lien. Nous sélectionnons les intervenants selon une charte simple (qualité, transparence, pas de promesse clinique, feedback).

Prochaine étape:
1) validation de votre profil,
2) choix de vos thématiques,
3) intégration au réseau pilote.

Bien à vous,
[Nom / Avillage]`;
            navigator.clipboard?.writeText(txt);
            addLog("Template message intervenant copié (clipboard).");
          });
          const closeNow = $("#closeNow2");
          if(closeNow) closeNow.addEventListener("click", closeModal);
        }, 0);
      });
    }
    const proCharter = $("#pro_charter");
    if(proCharter){
      proCharter.addEventListener("click", ()=>{
        openModal("Charte Avillage (brouillon)", `
          <div style="color:var(--muted); font-size:13px; line-height:1.55;">
            <b style="color:var(--fg);">1) Position</b> : prévention / orientation / continuité (pas de promesses cliniques).<br>
            <b style="color:var(--fg);">2) Qualité</b> : clarté, limites, respect, feedback post-mission.<br>
            <b style="color:var(--fg);">3) Données</b> : minimisation, pas de santé stockée sur Avillage.<br>
            <b style="color:var(--fg);">4) IRL</b> : quand possible, proposer des sorties vers le réel (groupes, activités, relais).<br>
            <b style="color:var(--fg);">5) Réseau</b> : Avillage peut déréférencer en cas de retours négatifs répétés.
          </div>
        `);
      });
    }

    // irl
    const irlSubmit = $("#irl_submit");
    if(irlSubmit){
      irlSubmit.addEventListener("click", ()=>{
        const zone = $("#irl_zone").value.trim() || "ta zone";
        const type = $("#irl_type").value;
        const need = $("#irl_need").value.trim();

        const out = $("#irl_out");
        out.innerHTML = `
          <b style="color:var(--fg); font-weight:750;">Prototype IRL :</b>
          <div style="margin-top:6px; color:var(--muted); line-height:1.45;">
            Recherche “${type}” près de <b style="color:var(--fg);">${zone}</b>.
            <br>Critères : accessibilité, langue, délai, coût.
            <br><br><span style="opacity:.9;">(À brancher plus tard sur une base locale + validation partenaires.)</span>
          </div>
        `;
        addLog(`Demande IRL: ${type} — ${zone}`);
      });
    }
    const irlStub = $("#irl_stub");
    if(irlStub){
      irlStub.addEventListener("click", ()=>{
        openModal("Pourquoi Village IRL ?", `
          <div style="color:var(--muted); font-size:13px; line-height:1.55;">
            Avillage n’est pas un “réseau social” de plus. Le numérique est une rampe d’accès.
            <br><br><b style="color:var(--fg);">Objectif :</b> moins d’errance, plus de lien réel.
            <br><b style="color:var(--fg);">Mesure :</b> sorties IRL déclenchées, demandes mieux orientées, charge mentale réduite.
          </div>
        `);
      });
    }

    // main panel open buttons
    $$("[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=> navigate(btn.getAttribute("data-open")));
    });
  }

  // ---------- Triage (right card) ----------
  function suggestNextStep({sit, age, need, goal}){
    // ultra simple heuristic (placeholder)
    const hints = [];
    if(goal === "irl" || /irl/i.test(need || "")) hints.push("Proposer 3 pistes <b>Village IRL</b> (groupes/activités) + un plan d’action 7 jours.");
    if(/sommeil/i.test(sit) || /sleep/i.test(sit)) hints.push("Définir une “zone calme” 60 min avant le coucher + une alternative IRL courte (marche, lecture, douche).");
    if(/conflit/i.test(sit)) hints.push("Mettre 1 règle simple co-construite + 1 rituel IRL quotidien de 10 min (sans écran).");
    if(/après/i.test(sit) || /conférence/i.test(sit)) hints.push("Envoyer le pack post-conférence : <b>orientation</b> + <b>ressources</b> + <b>mise en lien</b>.");
    if(!hints.length) hints.push("Choisir un objectif unique (rythme / conflit / temps d’écran) + une sortie IRL hebdomadaire.");

    const html = `<div style="color:var(--muted); line-height:1.45;">
      <div><b style="color:var(--fg);">1)</b> ${hints[0]}</div>
      <div style="margin-top:6px;"><b style="color:var(--fg);">2)</b> Ensuite : ressources ciblées + option mise en relation.</div>
      <div style="margin-top:6px; opacity:.9;">Rappel : pas de diagnostic. Si urgence/sécurité → services adaptés.</div>
    </div>`;
    return { html };
  }

  $("#triageGo").addEventListener("click", ()=>{
    const ctx = $("#ctx").value;
    const prio = $("#prio").value;
    const age = $("#age").value;
    const goal = $("#goal").value;

    const suggestion = suggestNextStep({
      sit: ctx.includes("after") ? "Après une conférence" : ctx,
      age,
      need: prio,
      goal
    });

    $("#triageOut").innerHTML = `<b style="color:var(--fg); font-weight:750;">Suggestion :</b> ${suggestion.html}`;
    addLog(`Triage effectué: ctx=${ctx}, prio=${prio}, age=${age}, goal=${goal}`);
  });

  // ---------- Quick input ----------
  $("#quickGo").addEventListener("click", ()=>{
    const t = ($("#quickInput").value || "").toLowerCase();
    if(t.includes("entreprise") || t.includes("rh") || t.includes("wellbeing")) return navigate("enterprise");
    if(t.includes("parent") || t.includes("famille")) return navigate("family");
    if(t.includes("intervenant") || t.includes("pro") || t.includes("psych") || t.includes("médecin")) return navigate("pro");
    if(t.includes("irl") || t.includes("réel") || t.includes("rencontr")) return navigate("irl");
    if(t.includes("boucle") || t.includes("loop")) return navigate("loop");
    return navigate("resources");
  });
  $("#quickInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") $("#quickGo").click(); });

  // ---------- Spiral nodes click ----------
  $$(".node").forEach(n=>{
    n.addEventListener("click", ()=> navigate(n.dataset.target));
  });
  $("#goHome").addEventListener("click", ()=> navigate("home"));
  $("#goIrl").addEventListener("click", ()=> navigate("irl"));

  // ---------- Top buttons ----------
  $("#openBrief").addEventListener("click", ()=> openModal("La boucle Avillage", loopView()));
  $("#openSettings").addEventListener("click", ()=>{
    const s = state.settings;
    openModal("Préférences (local)", `
      <div class="form">
        <div class="row">
          <div>
            <label>Accent</label>
            <select class="field" id="set_accent">
              <option value="sapin" ${s.accent==="sapin"?"selected":""}>Vert sapin (sobre)</option>
              <option value="prune" ${s.accent==="prune"?"selected":""}>Prune (sobre)</option>
              <option value="ocre" ${s.accent==="ocre"?"selected":""}>Ocre (rare)</option>
            </select>
          </div>
          <div>
            <label>Confidentialité</label>
            <select class="field" id="set_privacy">
              <option value="minimal" ${s.privacy==="minimal"?"selected":""}>Minimale (recommandé)</option>
              <option value="off" ${s.privacy==="off"?"selected":""}>Journal désactivé</option>
            </select>
          </div>
        </div>
        <button class="btn primary" id="saveSettings">Enregistrer</button>
        <div class="hint">Ces préférences restent uniquement sur cet appareil.</div>
      </div>
    `);
    setTimeout(()=>{
      $("#saveSettings")?.addEventListener("click", ()=>{
        state.settings.accent = $("#set_accent").value;
        state.settings.privacy = $("#set_privacy").value;
        store.set("avillage_settings", state.settings);
        applyAccent();
        addLog("Préférences mises à jour.");
        closeModal();
      });
    }, 0);
  });

  function applyAccent(){
    // Minimal accent switch: tweak glow color by swapping a CSS variable via inline style
    // (Still sober; this is just a little visual identity knob)
    const root = document.documentElement;
    const acc = state.settings.accent;
    let glow;
    if(acc === "prune") glow = "0 0 22px rgba(140, 60, 120, .18)";
    else if(acc === "ocre") glow = "0 0 22px rgba(180, 130, 60, .16)";
    else glow = "0 0 22px rgba(28, 175, 120, .18)";
    root.style.setProperty("--glow", glow);
  }

  // ---------- Export / Reset ----------
  $("#exportBtn").addEventListener("click", (e)=>{
    e.preventDefault();
    const payload = {
      mode: state.mode,
      log: state.log,
      leads: state.leads,
      settings: state.settings,
      exportedAt: now()
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "avillage_export.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    addLog("Export JSON généré.");
  });

  $("#resetBtn").addEventListener("click", (e)=>{
    e.preventDefault();
    openModal("Réinitialiser ?", `
      <div style="color:var(--muted); font-size:13px; line-height:1.5;">
        Ceci efface le journal et les leads stockés localement.
      </div>
      <div style="margin-top:12px; display:flex; gap:10px;">
        <button class="btn primary" id="doReset">Tout effacer</button>
        <button class="btn ghost" id="noReset">Annuler</button>
      </div>
    `);
    setTimeout(()=>{
      $("#doReset")?.addEventListener("click", ()=>{
        localStorage.removeItem("avillage_log");
        localStorage.removeItem("avillage_leads");
        localStorage.removeItem("avillage_mode");
        // keep settings optionally
        state.log = [];
        state.leads = [];
        setMode("Accueil");
        setMainPanel("home");
        renderLog();
        closeModal();
      });
      $("#noReset")?.addEventListener("click", closeModal);
    },0);
  });

  // ---------- Mode chip cycle ----------
  $("#modeChip").addEventListener("click", ()=>{
    const seq = ["Accueil","Entreprise","Famille","Intervenant","Village IRL","Ressources","La boucle"];
    const i = seq.indexOf(state.mode);
    const next = seq[(i+1) % seq.length];
    const map = {
      "Accueil":"home",
      "Entreprise":"enterprise",
      "Famille":"family",
      "Intervenant":"pro",
      "Village IRL":"irl",
      "Ressources":"resources",
      "La boucle":"loop"
    };
    navigate(map[next]);
  });

  // ---------- Init ----------
  function init(){
    applyAccent();
    renderLog();
    // initial panel based on state.mode
    const rev = {
      "Accueil":"home",
      "Entreprise":"enterprise",
      "Famille":"family",
      "Intervenant":"pro",
      "Village IRL":"irl",
      "Ressources":"resources",
      "La boucle":"loop"
    };
    $("#modeLabel").textContent = state.mode;
    setMainPanel(rev[state.mode] || "home");
    addLog("Prototype chargé.");
    // after panel set, wire events
    wirePanelEvents();
  }

  // re-wire events when panel changes
  const origSetMainPanel = setMainPanel;
  setMainPanel = function(kind){
    origSetMainPanel(kind);
    wirePanelEvents();
  };

  init();
</script>
</body>
</html>
